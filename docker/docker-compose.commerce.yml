# Garfenter Commerce Suite (Group A)
# Saleor, Spurt Commerce, OSPOS, Bigcapital
# ~2GB RAM total

version: '3.8'

services:
  # ============================================
  # Saleor - E-commerce (Garfenter Tienda)
  # ============================================
  garfenter-tienda:
    image: ghcr.io/saleor/saleor:3.19
    container_name: garfenter-tienda
    restart: unless-stopped
    environment:
      DATABASE_URL: postgresql://garfenter:${POSTGRES_PASSWORD}@garfenter-postgres:5432/garfenter_tienda
      REDIS_URL: redis://garfenter-redis:6379/0
      SECRET_KEY: ${JWT_SECRET}
      ALLOWED_HOSTS: "*"
      DEBUG: "False"
      DEFAULT_CHANNEL_SLUG: default-channel
      DEFAULT_COUNTRY: GT
      DEFAULT_CURRENCY: GTQ
      LANGUAGE_CODE: es
    ports:
      - "8001:8000"
    networks:
      - garfenter-network
    depends_on:
      - garfenter-postgres
      - garfenter-redis
    deploy:
      resources:
        limits:
          memory: 512M

  # ============================================
  # Spurt Commerce - Marketplace (Garfenter Mercado)
  # ============================================
  garfenter-mercado:
    image: spurtcommerce/spurtcommerce:latest
    container_name: garfenter-mercado
    restart: unless-stopped
    environment:
      TYPEORM_CONNECTION: mysql
      TYPEORM_HOST: garfenter-mysql
      TYPEORM_PORT: 3306
      TYPEORM_USERNAME: garfenter
      TYPEORM_PASSWORD: ${MYSQL_PASSWORD}
      TYPEORM_DATABASE: garfenter_mercado
      APP_PORT: 8000
      JWT_SECRET: ${JWT_SECRET}
      CRYPTO_SECRET: ${CRYPTO_SECRET}
      LOCALE: es_GT
      CURRENCY: GTQ
    ports:
      - "9000:8000"
    networks:
      - garfenter-network
    depends_on:
      - garfenter-mysql
    deploy:
      resources:
        limits:
          memory: 512M

  # ============================================
  # Open Source POS (Garfenter POS)
  # ============================================
  garfenter-pos:
    image: opensourcepos/opensourcepos:latest
    container_name: garfenter-pos
    restart: unless-stopped
    environment:
      DB_HOST: garfenter-mysql
      DB_NAME: garfenter_pos
      DB_USER: garfenter
      DB_PASS: ${MYSQL_PASSWORD}
      PHP_TIMEZONE: America/Guatemala
      FORCE_HTTPS: "false"
    ports:
      - "8081:80"
    networks:
      - garfenter-network
    depends_on:
      - garfenter-mysql
    deploy:
      resources:
        limits:
          memory: 256M

  # ============================================
  # Bigcapital - Accounting (Garfenter Contable)
  # ============================================
  garfenter-contable:
    image: bigcapital/bigcapital:latest
    container_name: garfenter-contable
    restart: unless-stopped
    environment:
      DATABASE_URL: postgresql://garfenter:${POSTGRES_PASSWORD}@garfenter-postgres:5432/garfenter_contable
      REDIS_URL: redis://garfenter-redis:6379/1
      JWT_SECRET: ${JWT_SECRET}
      BASE_URL: http://localhost:3000
    ports:
      - "3000:3000"
    networks:
      - garfenter-network
    depends_on:
      - garfenter-postgres
      - garfenter-redis
    deploy:
      resources:
        limits:
          memory: 512M

networks:
  garfenter-network:
    external: true
